# 製造工程管理システム

![Python](https://img.shields.io/badge/python-3.8+-blue.svg)
![Flask](https://img.shields.io/badge/flask-2.3-green.svg)

工場のDX(デジタルトランスフォーメーション)推進の一環として開発した、Web ベースの製造工程管理システムです。

## 📋 概要

本システムは、製造現場における生産記録管理の非効率性を解決するために開発しました。

**解決した課題:**
- 生産実績の記録に**三重入力**(紙 → Excel → 基幹システム)が必要
- **月間100時間以上**の手作業による転記作業
- 手作業による転記ミスのリスク
- 生産進捗のリアルタイム把握が困難

**実装した解決策:**
- iPadによるリアルタイムデータ入力システム
- 紙帳票の完全撤廃
- USBメモリ経由での既存基幹システム連携
- 画像保存機能付き目視検査(VI)欠陥追跡

## 💰 ビジネスインパクト

- **コスト削減:** 年間360万円〜1,800万円(生産量により変動)
- **工数削減:** 月間100時間以上の入力作業を削減
- **品質向上:** 手作業による転記ミスを完全撤廃
- **可視化:** 生産進捗をリアルタイムで把握可能

## 🛠️ 技術スタック

### バックエンド
- **Python 3.8+**
- **Flask 2.3** - Webフレームワーク
- **SQLAlchemy** - ORM
- **SQLite** - データベース

### フロントエンド
- **HTML5/CSS3/JavaScript**
- **jQuery 3.6** - DOM操作
- **SVG** - 目視検査UI

### セキュリティ
- **Flask-WTF** - CSRF保護
- **パス検証** - パストラバーサル攻撃防止
- **入力サニタイズ** - XSS攻撃防止
- **包括的ロギング** - 監査証跡

### インフラ
- オンプレミスWindowsサーバー
- Wi-Fiアクセスポイント(iPad 20台接続)
- Apache Webサーバー

## 📁 プロジェクト構成

```
manufacturing-app/
├── app/
│   ├── controllers/
│   │   └── guide.py          # メインアプリケーションルート
│   ├── models/
│   │   ├── db.py              # データベース接続
│   │   └── vi.py              # 目視検査モデル
│   └── ...
├── static/
│   ├── vi.css                # スタイルシート
│   ├── vi.js                 # フロントエンドロジック
│   └── ...
├── templates/
│   ├── base.html             # ベーステンプレート
│   ├── index.html            # トップページ
│   └── vi.html               # 目視検査フォーム
├── visImage/                 # 検査画像保存先
├── main.py                   # アプリケーションエントリーポイント
├── settings.py               # 設定ファイル
├── requirements.txt          # Python依存関係
├── .env.example              # 環境変数テンプレート
├── app_sample.db             # サンプルデータベース
├── workers_sample.txt        # サンプル作業者リスト
└── README.md
```

## 🚀 セットアップ方法

### 前提条件

- Python 3.8以上
- pipパッケージマネージャー

### インストール手順

1. **リポジトリのクローン:**
```bash
git clone https://github.com/Rambo-333/manufacturing-process-management.git
cd manufacturing-process-management
```

2. **仮想環境の作成:**
```bash
python -m venv .venv
source .venv/bin/activate  # Windows の場合: .venv\Scripts\activate
```

3. **依存関係のインストール:**
```bash
pip install -r requirements.txt
```

4. **環境変数の設定:**
```bash
cp .env.example .env
# .env ファイルを編集して設定を変更
```

5. **アプリケーションの起動:**
```bash
python main.py
```

6. **アクセス:**
```
http://localhost:5050
```

## ⚙️ 設定

すべての設定は環境変数で管理されます。`.env.example` を参照してください:

```bash
# データベース設定
DATABASE_URL=sqlite:///app.db

# セキュリティ
SECRET_KEY=your-secret-key-change-in-production

# サーバー設定
HOST=localhost
PORT=5050
DEBUG=True

# セッション設定
SESSION_LIFETIME=3600

# ファイルアップロード制限
MAX_CONTENT_LENGTH=16777216

# ログ設定
LOG_LEVEL=INFO
```

## 🔐 セキュリティ機能

- **CSRF保護:** 全フォームにFlask-WTFトークンを実装
- **パストラバーサル防止:** 正規表現とPath().nameによる入力検証
- **ファイルサイズ制限:** 画像アップロードは最大10MB
- **入力サニタイズ:** ホワイトリスト方式によるフィールド検証
- **エラーハンドリング:** 包括的なtry-exceptブロックとロギング
- **監査証跡:** タイムスタンプ付きで全操作をログ記録

## 📊 主要機能

### 1. 生産実績入力

- iPadによるリアルタイムデータ入力
- 自動タイムスタンプ記録
- 作業者割り当て管理
- 製造日/品質検査日の分離

### 2. 目視検査(VI)

- SVGベースのインタラクティブな欠陥マッピング
- 画像キャプチャと保存
- 欠陥タイプの分類:
  - 気泡、キズ、カケ
  - 凸部、クボミ、異物
  - 研磨跡など
- 全長範囲別管理

### 3. データ管理

- ロット番号による検索
- 過去データ取得(最大50件)
- 基幹システム連携用USBデータエクスポート

## 🔧 開発の経緯

このプロジェクトが示すスキル:

1. **課題解決能力:** 実際のビジネス課題を特定・解決
2. **フルスタック開発:** フロント・バック・DB・インフラまで一気通貫
3. **自己学習力:** インターネットで調べながら独力で構築
4. **AI活用能力(2025年):**
   - セキュリティ対策(CSRF保護、パストラバーサル防止)を実装
   - エラーハンドリングとロギングの追加
   - AIペアプログラミング(Cursor/Claude)でコード品質向上

### コード品質の向上

**セキュリティ強化:**
- CSRF保護の実装
- パストラバーサル攻撃防止
- ファイルサイズ検証の追加
- 包括的なエラーハンドリングとロギング

**アーキテクチャ改善:**
- データベースセッションのContext Manager化
- マジックナンバーの定数化
- 重複コードの削減

## 📝 サンプルデータ

リポジトリには以下のサンプルファイルが含まれています:

- `app_sample.db` - サンプルレコード付きDBスキーマ
- `workers_sample.txt` - サンプル作業者リスト
- `workers2_sample.txt` - サンプル品質保証担当者リスト

**注意:** プライバシー保護のため、実際の生産データは全て削除されています。

## 🚫 制限事項

- **認証機能:** ログインシステムなし(シングルユーザー環境)
- **データベース:** SQLite使用(小規模展開向け)
- **スケーラビリティ:** 単一工場向け設計(最大50同時接続)

## 👤 作成者

**Rambo**

- GitHub: [@Rambo-333](https://github.com/Rambo-333)

## 🙏 謝辞

本プロジェクトは工場のデジタルトランスフォーメーション(DX)推進の一環として開発されました。以下のスキルを証明します:

- 実際のビジネス環境での独立した問題解決能力
- 要件定義から展開までのフルスタック開発
- 継続的改善のマインドセット(2025年のAI支援リファクタリング)
- 測定可能なビジネスインパクト(年間最大1,800万円の削減効果)

---

**ポートフォリオ注記:** これは本番コードをサニタイズしたバージョンです。企業固有の情報、生産データ、認証情報は全て削除されています。コードは2025年にAI支援開発ツールを使用して、最新のセキュリティ基準を満たすようリファクタリングされています。
